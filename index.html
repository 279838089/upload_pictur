<!doctype html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhml1-strict.dtd">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<script src="http://cdn.bootcss.com/jquery/1.8.3/jquery.min.js"></script>
</head>

<body>
<form action="upload.php" method="post" enctype="multipart/form-data"  target="upframe" id="form" >
	<div id="upLoadFile">
	<input type="file"  name="upfile" id="photo" onchange="upload();">
	</div>
	<input id="id" name="id" type="hidden" value="1"/>
	<input id="type" name="type" type="hidden" value="upload"/>
	<input type="hidden" id="all_image" value="">
</form>

<div id="image" class="image"></div>
<div id="return_text"></div>
<iframe id="upframe" name="upframe" style="display:none"></iframe>

</body>

<script type="text/javascript">
	function upload(){
		$('#form').submit();
	}
	
	function return_text(msg){
		$('#return_text').html(msg);
	}
	
	function add(data){
    	var n=parseInt(Math.random()*100000);
    	if($("#all_image").val()=='')
    		image=data;
    	else
    		image=$("#all_image").val()+";"+data;
    	$("#all_image").val(image);
    	n='picture'+n;
		
		$('#image').append('<div id="'+n+'" style="float:left;"><a href="'+data+'"  target="_blank"><img src="'+data+'"  height=80 width=80 /></a><div class="del"><a href="#" onclick=del("'+n+'");return false;>删除</a></div></div>');
		$('#upLoadFile').html('<input type="file"  name="upfile" id="photo" onchange="upload();">');
		
	}
	
	function del(delName){			//点击删除链接，ajax
		var d='#'+delName;
		//删除的图片
		img=$(d+" img").attr('src');
		//全部的图片
		all_img=$("#all_image").val();
		//全部图片里面把删除的图片替换成空
		str=all_img.replace(img+';',"");
		str=str.replace(img,"");
		
		$("#all_image").val(str);
		
		$(d).html("success");	
        $(d).hide(300);							//自动隐藏
		
		$.ajax({
				type: "POST", //提交的类型
				url: "upload.php",
				data:{type:"del_photo",name:img},//参数
				success: function(msg){ //回调方法
				
				}
		})
    }
</script>
</html>